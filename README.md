# 6

### Пошаговое руководство по настройке резервного копирования

---

#### **1. Создание инстансов Cloud-BACKUP01 и Cloud-BACKUP02**
1. **Параметры инстансов**:
   - Тип: 1 vCPU, 1 ГБ RAM.
   - Диск: 10 ГБ (системный) + 5 ГБ (дополнительный том).
   - ОС: Альт Starterkit (`alt-p10-cloud-x86_64`).

2. **Подключение дополнительного тома (5 ГБ)**:
   - После создания инстансов проверьте имя блочного устройства (например, `/dev/sdb` через `lsblk`).

---

#### **2. Установка Кибер Бекап 17**
1. **На всех инстансах (Cloud-ADM, BACKUP01, BACKUP02)**:
   ```bash
   # Добавление репозитория Кибер Бекап (если требуется)
   sudo apt-get update
   sudo apt-get install -y cyber-backup-server cyber-backup-agent  # Для Cloud-ADM
   sudo apt-get install -y cyber-backup-agent                     # Для BACKUP01 и BACKUP02
   ```

2. **Настройка сервера управления на Cloud-ADM**:
   - Запустите сервис:
     ```bash
     sudo systemctl start cyber-backup-server
     sudo systemctl enable cyber-backup-server
     ```
   - Откройте веб-интерфейс: `http://Cloud-ADM-IP:8080`.

3. **Создание организации и пользователя**:
   - Войдите в веб-интерфейс (логин/пароль по умолчанию: `admin/admin`).
   - Создайте организацию **AU_Team**.
   - Добавьте пользователя **au-admin** с паролем `P@ssw0rd` и правами администратора.

---

#### **3. Настройка устройств хранения на BACKUP01 и BACKUP02**
1. **Форматирование и монтирование диска**:
   ```bash
   # Проверьте имя устройства (например, /dev/sdb)
   sudo mkfs.xfs /dev/sdb
   sudo mkdir /backups
   sudo mount /dev/sdb /backups
   # Добавьте в /etc/fstab для автоматического монтирования
   echo "/dev/sdb /backups xfs defaults 0 0" | sudo tee -a /etc/fstab
   ```

2. **Регистрация узлов хранения в Кибер Бекап**:
   - В веб-интерфейсе Кибер Бекап:
     - Перейдите в **Узлы хранения** → **Добавить**.
     - Название: **BACKUP01** (для Cloud-BACKUP01), **BACKUP02** (для Cloud-BACKUP02).
     - Тип: **Файловое хранилище**.
     - Путь: `/backups`.
     - Укажите IP-адрес инстанса и аутентификационные данные (логин/пароль пользователя `altlinux`).

---

#### **4. Создание плана резервного копирования для Cloud-ADM**
1. **Добавление источника резервного копирования**:
   - В веб-интерфейсе Кибер Бекап:
     - Перейдите в **Задачи** → **Резервное копирование** → **Создать**.
     - Имя задачи: `Backup_altlinux_home`.
     - Источник: Укажите путь `/home/altlinux` на Cloud-ADM.
     - Целевое хранилище: **BACKUP01**.

2. **Запуск резервного копирования**:
   - Выберите задачу → **Запустить сейчас**.
   - Проверьте статус выполнения в журнале задач.

---

#### **5. Настройка плана репликации на BACKUP02**
1. **Создание задачи репликации**:
   - Перейдите в **Задачи** → **Репликация** → **Создать**.
   - Имя задачи: `Replica_altlinux_home`.
   - Источник: Существующая резервная копия на **BACKUP01**.
   - Целевое хранилище: **BACKUP02**.

2. **Запуск репликации**:
   - Запустите задачу вручную или настройте расписание.
   - Убедитесь, что данные скопированы на **BACKUP02** через веб-интерфейс.

---

#### **6. Проверка работы**
1. **Резервная копия**:
   - Убедитесь, что файлы из `/home/altlinux` доступны в хранилище **BACKUP01**.

2. **Репликация**:
   - Проверьте наличие копии на **BACKUP02**.

---

#### **Типичные проблемы и решения**
- **Ошибка монтирования диска**: Убедитесь, что устройство `/dev/sdb` существует (используйте `lsblk`).
- **Доступ к веб-интерфейсу**: Проверьте фаерволл на Cloud-ADM (разрешите порт `8080` и `3000`).
- **Аутентификация узлов хранения**: Используйте SSH-ключ или пароль пользователя `altlinux` для доступа к инстансам.

**Готово!** Система резервного копирования настроена.
